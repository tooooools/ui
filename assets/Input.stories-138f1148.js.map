{"version":3,"file":"Input.stories-138f1148.js","sources":["../../lib/components/Input.jsx"],"sourcesContent":["import style from './Input.module.scss'\n\nimport { Component } from '../jsx'\nimport { ensure, writable } from '../state'\n\nimport noop from '../utils/noop'\n\nexport default class Input extends Component {\n  beforeRender (props) {\n    this.update = this.update.bind(this)\n    this.handleClick = this.handleClick.bind(this)\n    this.handleDblClick = this.handleDblClick.bind(this)\n    this.handleInput = this.handleInput.bind(this)\n    this.handleFocus = this.handleFocus.bind(this)\n\n    this.state = {\n      value: ensure(writable)(props['store-value'], props.value),\n      files: ensure(writable)(props['store-files'], props.files),\n\n      placeholder: ensure(writable)(props['store-placeholder'], props.placeholder),\n      title: ensure(writable)(props['store-title'], props.title),\n      label: ensure(writable)(props['store-label'], props.label),\n      before: ensure(writable)(props['store-before'], props.before),\n      after: ensure(writable)(props['store-after'], props.after),\n      icon: ensure(writable)(props['store-icon'], props.icon),\n\n      accept: ensure(writable)(props['store-accept'], props.accept ?? '*'),\n      multiple: ensure(writable)(props['store-multiple'], props.multiple ?? '*'),\n      min: ensure(writable)(props['store-min'], props.min),\n      max: ensure(writable)(props['store-max'], props.max),\n      step: ensure(writable)(props['store-step'], props.step),\n\n      active: ensure(writable)(props['store-active'], props.active),\n      disabled: ensure(writable)(props['store-disabled'], props.disabled),\n      hidden: ensure(writable)(props['store-hidden'], props.hidden),\n      waiting: ensure(writable)(props['store-waiting'], props.waiting)\n    }\n  }\n\n  template (props, state) {\n    return (\n      <div\n        {...this.dataProps}\n        id={props.id}\n        tabIndex={props.tabindex}\n        class={[\n          style.input,\n          {\n            'is-edited-on-dblclick': Boolean(props.editOnDblClick),\n            'has-icon': state.icon,\n            'is-active': state.active,\n            'is-disabled': state.disabled,\n            'is-hidden': state.hidden,\n            'is-waiting': state.waiting\n          },\n          ...(Array.isArray(props.class) ? props.class : [props.class])\n        ]}\n        data-type={props.type}\n        store-title={state.title}\n        event-click={this.handleClick}\n        event-dblclick={this.handleDblClick}\n        event-mouseenter={e => (props['event-mouseenter'] ?? noop)(e, this)}\n        event-mouseleave={e => (props['event-mouseleave'] ?? noop)(e, this)}\n      >\n        <span\n          ref={this.ref('icon')}\n          class={style.input__icon}\n          store-innerHTML={state.icon}\n        />\n        <label class={style.input__label} store-innerHTML={state.label} />\n        <label class={style.input__before} store-innerHTML={state.before} />\n        <input\n          ref={this.ref('input')}\n          type={props.type}\n          name={props.name}\n          autofocus={props.autofocus}\n          autocomplete={props.autocomplete ?? 'off'}\n          size={props.type !== 'number' ? (props.size === 'auto' ? '' : props.size) : undefined}\n          store-min={props.type === 'number' ? state.min : undefined}\n          store-max={props.type === 'number' ? state.max : undefined}\n          store-step={props.type === 'number' ? state.step : undefined}\n          store-placeholder={state.placeholder}\n          store-accept={props.type === 'file' ? state.accept : undefined}\n          store-multiple={props.type === 'file' ? state.multiple : undefined}\n          store-disabled={state.disabled}\n          event-click={e => e.stopPropagation()}\n          event-input={this.handleInput}\n          event-focus={this.handleFocus}\n          event-blur={e => (props['event-blur'] ?? noop)(e, this)}\n        />\n        <label class={style.input__after} store-innerHTML={state.after} />\n      </div>\n    )\n  }\n\n  afterRender () {\n    this.state.value.subscribe(this.update)\n    this.update()\n  }\n\n  update () {\n    const value = this.state.value.get()\n\n    switch (this.props.type) {\n      case 'number': {\n        this.refs.input.value = +value\n        break\n      }\n\n      case 'file': {\n        this.refs.input.files = value\n        break\n      }\n\n      default: {\n        this.refs.input.value = value\n      }\n    }\n\n    if (this.props.size === 'auto') {\n      const length = (String(this.refs.input.value) ?? '').length || (this.state.placeholder.current ?? '').length || 1\n      if (this.props.type === 'number') {\n        this.refs.input.style.width = (length + 1) + 'ch'\n      } else {\n        this.refs.input.size = Math.max(1, length)\n      }\n    }\n  }\n\n  handleClick (e) {\n    if (this.props.type === 'file') this.refs.input.click()\n    else if (!this.props.editOnDblClick) this.refs.input.focus()\n\n    ;(this.props['event-click'] ?? noop)(e, this)\n  }\n\n  async handleDblClick (e) {\n    this.refs.input.focus()\n    await (this.props['event-dblclick'] ?? noop)(e, this)\n  }\n\n  async handleInput (e) {\n    if (this.state.waiting.get()) return e.preventDefault()\n\n    this.state.waiting.set(true)\n\n    switch (this.props.type) {\n      case 'number': this.state.value.set(+this.refs.input.value); break\n      case 'file': this.state.value.set(this.refs.input.files); break\n      default: this.state.value.set(this.refs.input.value)\n    }\n\n    await (this.props['event-input'] ?? noop)(e, this)\n\n    // Testing for mounted because event-click may have destroyed this component\n    if (!this.mounted) return\n    this.state.waiting.set(false)\n  }\n\n  handleFocus (e) {\n    if (this.props.autoSelectAll) this.refs.input.select()\n    ;(this.props['event-focus'] ?? noop)(e, this)\n  }\n\n  beforeDestroy () {\n    this.state.value.unsubscribe(this.update)\n  }\n}\n"],"names":["Input","Component","props","ensure","writable","state","h","style","e","noop","value","length"],"mappings":"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"}