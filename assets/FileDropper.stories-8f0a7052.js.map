{"version":3,"file":"FileDropper.stories-8f0a7052.js","sources":["../../lib/components/FileDropper.jsx"],"sourcesContent":["import style from './FileDropper.module.scss'\n\nimport { Component } from '../jsx'\nimport { writable } from '../state'\n\nimport Button from './Button'\n\nimport noop from '../utils/noop'\n\nexport default class FileDropper extends Component {\n  beforeRender (props) {\n    this.handleDragStart = this.handleDragStart.bind(this)\n    this.handleDragEnd = this.handleDragEnd.bind(this)\n    this.handleDrop = this.handleDrop.bind(this)\n\n    this.state = {\n      appliedTo: writable(undefined),\n      draggedOver: writable(false),\n\n      files: writable(null)\n    }\n  }\n\n  template (props, state) {\n    return (\n      <div\n        {...this.dataProps}\n        id={props.id}\n        class={[\n          style['file-dropper'],\n          {\n            'is-dragged-over': state.draggedOver\n          },\n          ...(Array.isArray(props.class) ? props.class : [props.class])\n        ]}\n      >\n        {props.children.length > 0\n          ? props.children\n          : (\n              (props.icon || props.label) ? <Button icon={props.icon} label={props.label} tabIndex={-1} /> : null\n            )}\n      </div>\n    )\n  }\n\n  afterMount (props) {\n    this.state.appliedTo = this.base.offsetParent ?? document.body\n    this.state.appliedTo.addEventListener('dragover', this.handleDragStart)\n    this.state.appliedTo.addEventListener('dragenter', this.handleDragStart)\n    this.state.appliedTo.addEventListener('dragleave', this.handleDragEnd)\n    this.state.appliedTo.addEventListener('dragend', this.handleDragEnd)\n    this.state.appliedTo.addEventListener('drop', this.handleDrop)\n  }\n\n  get isVisible () {\n    return this.base.offsetParent !== null\n  }\n\n  handleDragStart (e) {\n    if (!this.isVisible) return\n    if (!e.dataTransfer.types.includes('Files')) return\n    e.preventDefault()\n    e.stopPropagation()\n\n    this.state.draggedOver.set(true)\n  }\n\n  handleDrop (e) {\n    if (!this.isVisible) return\n\n    if (!e.dataTransfer.types.includes('Files')) {\n      this.state.files.set(null)\n      return\n    }\n\n    e.preventDefault()\n    e.stopPropagation()\n\n    this.state.files.set(e.dataTransfer.files)\n    ;(this.props['event-drop'] ?? noop)(e, this)\n    this.handleDragEnd(e)\n  }\n\n  handleDragEnd (e) {\n    if (!this.isVisible) return\n\n    if (!e.dataTransfer.types.includes('Files')) {\n      this.state.files.set(null)\n      return\n    }\n\n    e.preventDefault()\n    e.stopPropagation()\n\n    this.state.draggedOver.set(false)\n  }\n\n  beforeDestroy () {\n    this.state.appliedTo?.removeEventListener('dragover', this.handleDragStart)\n    this.state.appliedTo?.removeEventListener('dragenter', this.handleDragStart)\n    this.state.appliedTo?.removeEventListener('dragleave', this.handleDragEnd)\n    this.state.appliedTo?.removeEventListener('dragend', this.handleDragEnd)\n    this.state.appliedTo?.removeEventListener('drop', this.drop)\n  }\n}\n"],"names":["FileDropper","Component","props","writable","state","h","style","Button","noop","_a","_b","_c","_d","_e"],"mappings":"yXASA,MAAqBA,UAAoBC,CAAU,CACjD,aAAcC,EAAO,CACnB,KAAK,gBAAkB,KAAK,gBAAgB,KAAK,IAAI,EACrD,KAAK,cAAgB,KAAK,cAAc,KAAK,IAAI,EACjD,KAAK,WAAa,KAAK,WAAW,KAAK,IAAI,EAE3C,KAAK,MAAQ,CACX,UAAWC,EAAS,MAAS,EAC7B,YAAaA,EAAS,EAAK,EAE3B,MAAOA,EAAS,IAAI,CAAA,CAExB,CAEA,SAAUD,EAAOE,EAAO,CAEpB,OAAAC,EAAC,MAAA,CACE,GAAG,KAAK,UACT,GAAIH,EAAM,GACV,MAAO,CACLI,EAAM,cAAc,EACpB,CACE,kBAAmBF,EAAM,WAC3B,EACA,GAAI,MAAM,QAAQF,EAAM,KAAK,EAAIA,EAAM,MAAQ,CAACA,EAAM,KAAK,CAC7D,CAAA,EAECA,EAAM,SAAS,OAAS,EACrBA,EAAM,SAEHA,EAAM,MAAQA,EAAM,QAAUK,EAAO,CAAA,KAAML,EAAM,KAAM,MAAOA,EAAM,MAAO,SAAU,EAAI,CAAA,EAAK,IAAA,CAI3G,CAEA,WAAYA,EAAO,CACjB,KAAK,MAAM,UAAY,KAAK,KAAK,cAAgB,SAAS,KAC1D,KAAK,MAAM,UAAU,iBAAiB,WAAY,KAAK,eAAe,EACtE,KAAK,MAAM,UAAU,iBAAiB,YAAa,KAAK,eAAe,EACvE,KAAK,MAAM,UAAU,iBAAiB,YAAa,KAAK,aAAa,EACrE,KAAK,MAAM,UAAU,iBAAiB,UAAW,KAAK,aAAa,EACnE,KAAK,MAAM,UAAU,iBAAiB,OAAQ,KAAK,UAAU,CAC/D,CAEA,IAAI,WAAa,CACR,OAAA,KAAK,KAAK,eAAiB,IACpC,CAEA,gBAAiB,EAAG,CACb,KAAK,WACL,EAAE,aAAa,MAAM,SAAS,OAAO,IAC1C,EAAE,eAAe,EACjB,EAAE,gBAAgB,EAEb,KAAA,MAAM,YAAY,IAAI,EAAI,EACjC,CAEA,WAAY,EAAG,CACb,GAAK,KAAK,UAEV,IAAI,CAAC,EAAE,aAAa,MAAM,SAAS,OAAO,EAAG,CACtC,KAAA,MAAM,MAAM,IAAI,IAAI,EACzB,MACF,CAEA,EAAE,eAAe,EACjB,EAAE,gBAAgB,EAElB,KAAK,MAAM,MAAM,IAAI,EAAE,aAAa,KAAK,GACvC,KAAK,MAAM,YAAY,GAAKM,GAAM,EAAG,IAAI,EAC3C,KAAK,cAAc,CAAC,EACtB,CAEA,cAAe,EAAG,CAChB,GAAK,KAAK,UAEV,IAAI,CAAC,EAAE,aAAa,MAAM,SAAS,OAAO,EAAG,CACtC,KAAA,MAAM,MAAM,IAAI,IAAI,EACzB,MACF,CAEA,EAAE,eAAe,EACjB,EAAE,gBAAgB,EAEb,KAAA,MAAM,YAAY,IAAI,EAAK,EAClC,CAEA,eAAiB,gBACfC,EAAA,KAAK,MAAM,YAAX,MAAAA,EAAsB,oBAAoB,WAAY,KAAK,kBAC3DC,EAAA,KAAK,MAAM,YAAX,MAAAA,EAAsB,oBAAoB,YAAa,KAAK,kBAC5DC,EAAA,KAAK,MAAM,YAAX,MAAAA,EAAsB,oBAAoB,YAAa,KAAK,gBAC5DC,EAAA,KAAK,MAAM,YAAX,MAAAA,EAAsB,oBAAoB,UAAW,KAAK,gBAC1DC,EAAA,KAAK,MAAM,YAAX,MAAAA,EAAsB,oBAAoB,OAAQ,KAAK,KACzD,CACF;;;;;"}