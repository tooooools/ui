{"version":3,"file":"Select.stories-02e8e194.js","sources":["../../lib/utils/array-group-by.js","../../node_modules/iconoir/icons/nav-arrow-down.svg?raw","../../lib/components/Select.jsx"],"sourcesContent":["export default (array = [], key) => array.reduce((o, obj) => {\n  const group = obj[key]\n\n  if (!o[group]) o[group] = []\n  o[group].push(obj)\n\n  return o\n}, {})\n","export default \"<svg width=\\\"24\\\" height=\\\"24\\\" stroke-width=\\\"1.5\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n<path d=\\\"M6 9L12 15L18 9\\\" stroke=\\\"currentColor\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n</svg>\\n\"","import style from './Select.module.scss'\n\nimport { Component } from '../jsx'\nimport { ensure, derived, writable } from '../state'\n\nimport noop from '../utils/noop'\nimport groupBy from '../utils/array-group-by'\n\nimport IconDown from 'iconoir/icons/nav-arrow-down.svg?raw'\n\nexport default class Select extends Component {\n  static get separator () {\n    return { label: '', disabled: true }\n  }\n\n  beforeRender (props) {\n    this.update = this.update.bind(this)\n    this.handleChange = this.handleChange.bind(this)\n\n    this.state = {\n      title: ensure(writable)(props['store-title'], props.title),\n      label: ensure(writable)(props['store-label'], props.label),\n\n      value: ensure(writable)(props['store-value'], props.value),\n      options: ensure(writable)(props['store-options'], props.options),\n\n      disabled: ensure(writable)(props['store-disabled'], props.disabled),\n      hidden: ensure(writable)(props['store-hidden'], props.hidden)\n    }\n\n    // Infer the selected option index from state.value and state.options\n    const compare = props.compare ?? ((a, b) => a === b)\n    this.state.selectedIndex = derived([this.state.value, this.state.options], () => {\n      const options = this.state.options.get()\n      return options.findIndex(option => compare(option.value ?? option, this.state.value.current))\n    })\n  }\n\n  template (props, state) {\n    return (\n      <div\n        {...this.dataProps}\n        id={props.id}\n        class={[\n          style.select,\n          {\n            'is-disabled': state.disabled,\n            'is-hidden': state.hidden\n          },\n          ...(Array.isArray(props.class) ? props.class : [props.class])\n        ]}\n        event-mouseenter={e => (props['event-mouseenter'] ?? noop)(e, this)}\n        event-mouseleave={e => (props['event-mouseleave'] ?? noop)(e, this)}\n      >\n        {props.icon && (\n          <span\n            ref={this.ref('icon')}\n            class={style.select__icon}\n            innerHTML={props.icon}\n          />\n        )}\n\n        <div class={style.select__label} store-innerHTML={state.label} />\n\n        <select\n          ref={this.ref('select')}\n          name={props.name}\n          required={props.required}\n          tabIndex={props.tabindex}\n          store-title={state.title}\n          store-disabled={state.disabled}\n          event-change={this.handleChange}\n        />\n        <span class={style.select__arrow} innerHTML={props.dropdown ?? IconDown} />\n      </div>\n    )\n  }\n\n  afterRender () {\n    this.state.value.subscribe(this.update)\n    this.state.options.subscribe(this.update)\n    this.update()\n  }\n\n  clear () {\n    this.refs.select.innerHTML = ''\n  }\n\n  update () {\n    this.clear()\n\n    const options = this.state.options.get()\n    if (!options) return\n\n    const selectedIndex = this.state.selectedIndex.get()\n\n    if (this.props.placeholder) {\n      this.render((\n        <option\n          value=''\n          disabled\n          {...(this.state.value.current === undefined || selectedIndex < 0 ? { selected: true } : {})}\n        >\n          {this.props.placeholder}\n        </option>\n      ), this.refs.select)\n    }\n\n    for (const [label, entries] of Object.entries(groupBy(options, 'group'))) {\n      const children = entries.map(option => (\n        <option\n          value={options.indexOf(option)}\n          {...(option.disabled ? { disabled: true } : {})}\n          {...(options.indexOf(option) === selectedIndex ? { selected: true } : {})}\n        >\n          {option.label}\n        </option>\n      ))\n\n      if (label !== 'undefined') this.render(<optgroup label={label}>{children}</optgroup>, this.refs.select)\n      else this.render(children, this.refs.select)\n    }\n  }\n\n  handleChange (e) {\n    const index = +e.target.value\n    const selected = (this.state.options.get() ?? [])[index]\n\n    this.refs.select.blur()\n    this.state.value.set(selected ? (selected.value ?? selected) : null)\n\n    ;(this.props['event-change'] || noop)(e, this)\n  }\n\n  beforeDestroy () {\n    this.state.value.unsubscribe(this.update)\n    this.state.options.unsubscribe(this.update)\n  }\n}\n"],"names":["groupBy","array","key","o","obj","group","IconDown","Select","Component","props","ensure","writable","compare","a","b","derived","option","state","h","style","e","noop","options","selectedIndex","label","entries","children","index","selected"],"mappings":"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","x_google_ignoreList":[1]}