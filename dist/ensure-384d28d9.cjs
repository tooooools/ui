"use strict";function c(i,t,s,e){this.fn=t,this.ctx=s||null,this.owner=i,this.once=!!e}function u(i,t){t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.ctx=t.fn=t.owner=null,t===i._first&&(i._first=t.next),t===i._last&&(i._last=t.prev)}class l{constructor(){this._first=this._last=null}dispatch(t,s,e,r,f){let n=this._first;for(;n;)n.fn.call(n.ctx,t,s,e,r,f),n.once&&this.unsubscribe(n),n=n.next}subscribe(t,s,e){const r=new c(this,t,s,e);return this._first?(this._last.next=r,r.prev=this._last,this._last=r):(this._first=r,this._last=r),r}subscribeOnce(t,s){return this.subscribe(t,s,!0)}unsubscribe(t,s){if(t instanceof c)return u(this,t);s||(s=null);let e=this._first;for(;e;)e.fn===t&&e.ctx===s&&u(this,e),e=e.next}unsubscribeAll(){let t=this._first;for(this._first=this._last=null;t;)u(this,t),t=t.next}}function b(){return new l}class h extends l{constructor(t){super(),this.current=t}set(){throw new Error("Cannot set a different value for a Readable Signal. Use Writable instead")}get(){return this.current}}function o(i){return new h(i)}class a extends h{set(t,s){if(!s&&this.current===t)return;this.previous=this.current,this.current=t;let e=this._first;for(;e;)e.fn.call(e.ctx,this.current,this.previous),e.once&&this.unsubscribe(e),e=e.next}update(t,s){const e=t(this.current);this.set(e!==void 0?e:this.current,s)}}function _(i){return new a(i)}const x=i=>(...t)=>{for(const s of t){if(s instanceof l)return s;if(s!==void 0)return i(s)}return i(null)};exports.Writable=a;exports.ensure=x;exports.readable=o;exports.signal=b;exports.writable=_;
