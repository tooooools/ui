{"version":3,"file":"Backdrop-32c9f478.js","sources":["../../lib/components/Backdrop.jsx"],"sourcesContent":["import style from './Backdrop.module.scss'\n\nimport { Component } from '../jsx'\nimport { ensure, writable } from '../state'\n\nimport noop from '../utils/noop'\n\nexport default class Backdrop extends Component {\n  beforeRender (props) {\n    this.close = this.close.bind(this)\n    this.captureEscapeKey = this.captureEscapeKey.bind(this)\n\n    this.state = {\n      lastActiveElement: document.activeElement,\n      locked: ensure(writable)(props['store-locked'], props.locked)\n    }\n  }\n\n  template (props, state) {\n    return (\n      <div\n        {...this.dataProps}\n        id={props.id}\n        class={[\n          style.backdrop,\n          ...(Array.isArray(props.class) ? props.class : [props.class])\n        ]}\n        event-click={e => (props['event-click'] ?? noop)(e, this)}\n      >\n        {props.children}\n      </div>\n    )\n  }\n\n  afterMount () {\n    if (this.state.lastActiveElement) this.state.lastActiveElement.blur()\n    window.addEventListener('keyup', this.captureEscapeKey)\n    ;(this.props['event-open'] ?? noop)(null, this)\n  }\n\n  captureEscapeKey (e) {\n    if (e.key !== 'Escape') return\n    this.close()\n  }\n\n  close () {\n    if (this.state.locked.get()) return\n    ;(this.props['event-close'] || noop)(null, this)\n    if (this.destroyed) return\n    this.destroy()\n  }\n\n  beforeDestroy () {\n    if (this.destroyed) return\n    window.removeEventListener('keyup', this.captureEscapeKey)\n\n    if (this.state && this.state.lastActiveElement) {\n      // Store element inside the closure so that there is no reference error\n      // when calling the timeout after having destroyed the component\n      const el = this.state.lastActiveElement\n      window.setTimeout(() => el.focus(), 0)\n    }\n  }\n}\n"],"names":["Backdrop","Component","props","ensure","writable","state","h","style","e","noop","el"],"mappings":"yJAOA,MAAqBA,UAAiBC,CAAU,CAC9C,aAAcC,EAAO,CACnB,KAAK,MAAQ,KAAK,MAAM,KAAK,IAAI,EACjC,KAAK,iBAAmB,KAAK,iBAAiB,KAAK,IAAI,EAEvD,KAAK,MAAQ,CACX,kBAAmB,SAAS,cAC5B,OAAQC,EAAOC,CAAQ,EAAEF,EAAM,cAAc,EAAGA,EAAM,MAAM,CAAA,CAEhE,CAEA,SAAUA,EAAOG,EAAO,CAEpB,OAAAC,EAAC,MAAA,CACE,GAAG,KAAK,UACT,GAAIJ,EAAM,GACV,MAAO,CACLK,EAAM,SACN,GAAI,MAAM,QAAQL,EAAM,KAAK,EAAIA,EAAM,MAAQ,CAACA,EAAM,KAAK,CAC7D,EACA,cAAmBM,IAAAN,EAAM,aAAa,GAAKO,GAAMD,EAAG,IAAI,CAAA,EAEvDN,EAAM,QAAA,CAGb,CAEA,YAAc,CACR,KAAK,MAAM,mBAAwB,KAAA,MAAM,kBAAkB,OACxD,OAAA,iBAAiB,QAAS,KAAK,gBAAgB,GACpD,KAAK,MAAM,YAAY,GAAKO,GAAM,KAAM,IAAI,CAChD,CAEA,iBAAkB,EAAG,CACf,EAAE,MAAQ,UACd,KAAK,MAAM,CACb,CAEA,OAAS,CACH,KAAK,MAAM,OAAO,IAAI,KACxB,KAAK,MAAM,aAAa,GAAKA,GAAM,KAAM,IAAI,EAC3C,MAAK,WACT,KAAK,QAAQ,EACf,CAEA,eAAiB,CACf,GAAI,MAAK,YACF,OAAA,oBAAoB,QAAS,KAAK,gBAAgB,EAErD,KAAK,OAAS,KAAK,MAAM,mBAAmB,CAGxC,MAAAC,EAAK,KAAK,MAAM,kBACtB,OAAO,WAAW,IAAMA,EAAG,QAAS,CAAC,CACvC,CACF,CACF"}